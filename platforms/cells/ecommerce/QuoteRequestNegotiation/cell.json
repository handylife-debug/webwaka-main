{
  "cellId": "ecommerce/QuoteRequestNegotiation",
  "name": "QuoteRequestNegotiation",
  "version": "1.0.0",
  "description": "Quote request and negotiation management for B2B wholesale customers with real-time messaging, Nigerian market pricing support, and automated offer conversion. Enables wholesale customers to request custom quotes, negotiate terms, and convert approved quotes to orders.",
  "category": "ecommerce",
  "subcategory": "wholesale",
  "tags": ["quotes", "negotiation", "b2b", "messaging", "pricing", "nigerian-market"],
  
  "reusability": {
    "reuseFirst": true,
    "extendsCells": ["CustomerProfile", "B2BAccessControl", "CustomerEngagement"],
    "composesCells": ["TaxAndFee", "WholesalePricingTiers", "SalesEngine"],
    "reusesLibraries": ["sms-service", "replitmail", "auth-middleware"],
    "description": "100% cellular reusability extending customer management and B2B access control with communication infrastructure. Composes pricing cells for quote calculations while reusing existing messaging services."
  },

  "dependencies": {
    "cells": [
      {
        "cellId": "customer/CustomerProfile",
        "version": "^1.0.0",
        "required": true,
        "purpose": "Customer data management and contact information"
      },
      {
        "cellId": "ecommerce/B2BAccessControl", 
        "version": "^1.0.0",
        "required": true,
        "purpose": "B2B access verification and wholesale customer permissions"
      },
      {
        "cellId": "customer/CustomerEngagement",
        "version": "^1.0.0", 
        "required": true,
        "purpose": "Communication tracking and interaction history"
      },
      {
        "cellId": "ecommerce/WholesalePricingTiers",
        "version": "^1.0.0",
        "required": true,
        "purpose": "Dynamic pricing calculations for quote generation"
      },
      {
        "cellId": "inventory/TaxAndFee",
        "version": "^1.0.0",
        "required": true,
        "purpose": "Tax calculations and Nigerian VAT compliance"
      },
      {
        "cellId": "sales/SalesEngine",
        "version": "^1.0.0",
        "required": false,
        "purpose": "Order conversion when quotes are accepted"
      }
    ],
    "integrations": ["twilio", "replitmail", "payment-gateways"],
    "libraries": [
      "sms-service",
      "replitmail", 
      "auth-middleware",
      "permission-middleware",
      "user-management"
    ]
  },

  "features": {
    "core": [
      "Quote Request Creation",
      "Real-time Negotiation Messaging", 
      "Dynamic Pricing Calculations",
      "Quote Approval Workflow",
      "Automated Order Conversion",
      "Communication History Tracking",
      "Mobile SMS Notifications",
      "Email Quote Delivery"
    ],
    "nigerianMarket": [
      "Naira Currency Formatting",
      "Nigerian VAT Compliance (7.5%)",
      "Local SMS Provider Integration", 
      "Territory-based Pricing",
      "Payment Terms Negotiation",
      "Mobile Money Integration Ready",
      "Local Business Hours Support"
    ],
    "b2bSpecific": [
      "Bulk Quote Requests",
      "Volume Discount Negotiations", 
      "Credit Terms Management",
      "Multi-level Approvals",
      "Corporate Contact Management",
      "Recurring Quote Templates",
      "Procurement Integration Ready"
    ]
  },

  "database": {
    "tables": [
      {
        "name": "quote_requests",
        "purpose": "Master quote request records with customer and business details",
        "keyFields": ["id", "tenant_id", "customer_id", "status", "created_by"]
      },
      {
        "name": "quote_items",
        "purpose": "Individual line items within each quote request",
        "keyFields": ["id", "quote_request_id", "product_id", "requested_quantity", "unit_price"]
      },
      {
        "name": "negotiation_messages",
        "purpose": "Real-time messaging history between customer and sales team",
        "keyFields": ["id", "quote_request_id", "sender_id", "message_type", "content"]
      },
      {
        "name": "quote_offers",
        "purpose": "Formal pricing offers generated by sales team with terms",
        "keyFields": ["id", "quote_request_id", "offered_by", "total_amount", "validity_until"]
      },
      {
        "name": "quote_approvals",
        "purpose": "Multi-level approval workflow for high-value quotes",
        "keyFields": ["id", "quote_request_id", "approver_id", "approval_level", "status"]
      },
      {
        "name": "quote_conversions",
        "purpose": "Tracking successful quote-to-order conversions with metrics",
        "keyFields": ["id", "quote_request_id", "order_id", "conversion_rate", "sales_rep_id"]
      }
    ],
    "indexes": [
      "idx_quote_requests_tenant_customer",
      "idx_quote_requests_status_created",
      "idx_negotiation_messages_quote_timestamp", 
      "idx_quote_offers_validity_status",
      "idx_quote_conversions_success_rate"
    ],
    "constraints": [
      "UNIQUE(tenant_id, quote_number)",
      "CHECK(requested_quantity > 0)",
      "CHECK(total_amount >= 0)",
      "CHECK(validity_until > created_at)",
      "FOREIGN KEY references with CASCADE"
    ]
  },

  "api": {
    "endpoints": [
      {
        "path": "/quote-requests",
        "methods": ["GET", "POST"],
        "purpose": "List and create quote requests"
      },
      {
        "path": "/quote-requests/:id",
        "methods": ["GET", "PUT", "DELETE"],
        "purpose": "Individual quote request management"
      },
      {
        "path": "/quote-requests/:id/messages",
        "methods": ["GET", "POST"],
        "purpose": "Negotiation messaging interface"
      },
      {
        "path": "/quote-requests/:id/offers",
        "methods": ["GET", "POST"],
        "purpose": "Formal pricing offers management"
      },
      {
        "path": "/quote-requests/:id/approve",
        "methods": ["POST"],
        "purpose": "Quote approval workflow"
      },
      {
        "path": "/quote-requests/:id/convert",
        "methods": ["POST"],
        "purpose": "Convert approved quote to order"
      }
    ],
    "websockets": [
      {
        "endpoint": "/ws/quote/:id/negotiate",
        "purpose": "Real-time negotiation messaging"
      }
    ]
  },

  "ui": {
    "components": [
      "QuoteRequestForm",
      "NegotiationMessaging", 
      "QuoteOfferCard",
      "ApprovalWorkflow",
      "QuoteConversionSummary",
      "QuoteHistoryTimeline",
      "BulkQuoteManager",
      "QuotePrintTemplate"
    ],
    "pages": [
      "QuoteRequestList",
      "QuoteRequestDetails", 
      "QuoteNegotiation",
      "QuoteApprovals",
      "QuoteReports"
    ]
  },

  "notifications": {
    "sms": [
      "Quote request received",
      "New offer available", 
      "Quote approved/rejected",
      "Quote expiring reminder",
      "Order conversion success"
    ],
    "email": [
      "Formal quote PDF delivery",
      "Negotiation summary reports",
      "Approval workflow notifications",
      "Quote performance analytics",
      "Conversion success confirmations"
    ]
  },

  "security": {
    "authentication": "Required - B2B customer or sales team",
    "authorization": "Role-based - Customer, Sales Rep, Sales Manager, Finance Approver", 
    "tenantIsolation": "Strict - All queries filtered by tenant_id",
    "dataEncryption": "PII fields encrypted at rest",
    "auditTrail": "Complete quote lifecycle tracking"
  },

  "performance": {
    "caching": [
      "Quote calculations cached for 15 minutes",
      "Customer data cached via CustomerProfile cell",
      "Pricing tiers cached via WholesalePricingTiers cell"
    ],
    "optimization": [
      "Lazy load large quote histories",
      "Pagination for quote lists", 
      "Real-time messaging with connection pooling",
      "Background PDF generation",
      "Async notification dispatch"
    ]
  },

  "testing": {
    "unitTests": "Server methods, pricing calculations, message formatting",
    "integrationTests": "Cell composition, communication workflows, database operations",
    "e2eTests": "Complete quote lifecycle, negotiation flows, conversion tracking"
  },

  "documentation": {
    "businessWorkflow": "Quote request → Negotiation → Offer → Approval → Conversion",
    "cellComposition": "Extends customer management, composes pricing and sales cells",
    "integrationGuide": "SMS/Email setup, payment gateway connections, ERP integration",
    "apiReference": "Complete OpenAPI specification with examples"
  }
}